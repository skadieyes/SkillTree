# SSR、CSR、同构方案浅析
> 自JavaScript诞生以来，前端技术发展非常迅速。Web 前端诞生了 SSR 、CSR、预渲染等技术。

## CSR(Client-Side Rendering)
> 客户端渲染， 是现在前端比较常用的渲染方式。 

> 我们知道浏览器渲染包含 HTML 解析、DOM 树构建、CSSOM 构建、JavaScript 解析、布局、绘制，所以我们打开一个CSR渲染的页面，
首先要请求HTML文档，等HTML文档解析完成之后会进行首屏渲染，然后进行文件加载 （包括我们写的代码和用到的前端框架包等）， JS解析， 随后页面才会呈现出大体框架， 在需要填充服务端数据的地方， 调用API获取到业务数据后才能展示出最终的内容来。因为要等待文件加载、CSSOM 构建、JS 解析等过程，而这些过程比较耗时，导致用户会长时间出于不可交互的首白屏状态，从而给用户一种网页很“慢”的感觉。

### 几个常见的CSR框架
> Angular, React, Vue ...
### 优点
> 加载完成后页面之间切换速度很快

> 一定程度上减少了后端服务器的压力（不用管页面逻辑和渲染）

> 后端程序只需要提供API，跨平台问题不用考虑

### 缺点
> 首屏打开很慢

> 不利于SEO

### CSR和SEO的冲突
> 如果你的应用程序初始展示 loading 菊花图，然后通过 Ajax 获取内容，SEO抓取工具并不会等待异步完成后再行抓取页面内容。

> CSR往往通过AJAX获取原始数据，这很难保证我们的页面能够通过搜索引擎正常搜索到。

## SSR (Server-Side Rendering)
> 将SPA应用打包到服务器上，在服务器上渲染出HTML，发送到浏览器，这样的HTML页面还不具备交互能力，所以还需要与SPA框架配合，在浏览器上“混合”成可交互的应用程序。合理地运用SSR技术，能一定程度上解决首屏慢的问题，还能获得更好的SEO。

### SSR的优点
> 更快的响应时间，不用等待所有的JS都下载完成，浏览器便能显示比较完整的页面了。
> 更好的SEO，我们可以将SEO的关键信息直接在后台就渲染成HTML，而保证搜索引擎的爬虫都能爬取到关键数据。

### SSR的缺点
> 相对于仅仅需要提供静态文件的服务器，SSR中使用的渲染程序自然会占用更多的CPU和内存资源

> 一些常用的浏览器API可能无法正常使用，比如window、docment和alert等，如果使用的话需要对运行的环境加以判断

> 开发调试会有一些麻烦，因为涉及了浏览器及服务器，对于SPA的一些组件的生命周期的管理会变得复杂

> 可能会由于某些因素导致服务器端渲染的结果与浏览器端的结果不一致

### SSR常用框架
> React的Next

> Vue.js的Nuxt

### SSR演变过程
> JSP/ASP 都算，当然 Node 渲染模板也算，Node 世界模板最为丰富

> bigpipe，虽然很老了，但分块传输有点是非常明显的，且浏览器友好。fb和微博，qunar都是受益者。Node天然支持，res.write 很友好

> 基于组件写法的SSR，比如React SSR。时代变了，SSR也要跟上。vdom + hydrate玩的可以很嗨，连 bigpipe 也可以结合起来。umi SSR和rax SSR未来可期

> 真正的同构，即CSR和SSR写法一致，未来不再区分概念，在servless里，api和渲染都是函数。

### SSR需要考量的点
> 代码或框架层面需要兼容 server/client 的 runtime比较直接的一个就是 fetch 数据操作，如果服务端数据源有 rpc 协议或请求的服务存在环境/网络隔离，此时运行在客户端就获取不到数据，需要把 rpc 或存在环境/网络隔离的请求封装成通用的 http 接口，或者一些前端使用的库无法在后端运行，这些问题需要都进行特殊处理。

> 更复杂的部署和打包构建

> 部署和打包构建过程加倍，简单的理解就是单独的 server 和单独的 client 的工作总和。但是这个问题在 Egg-React-SSR 解决方案中已基本抹平，对开发者暴露的配置更加简单、可定制程度更高，同时提供了一键打包和构建命令。

> 增加服务端负载

> 这个“缺点”严格上是传统 SSR 的通病，但使用同构开发方式后完全可以变成了一个可优化的点。在使用同构方式时，可以针对服务端资源负载做监控，如果遇到有服务端负载过大或高峰时段，可以将渲染方式无缝切换成 CSR，待服务端负载正常或流量回落时再切换为 SSR。

## 参考资料
> 简书 [浅谈SPA、SEO、SSR](https://www.jianshu.com/p/fcb98533bc18)

> 知乎 [前端黑科技：美团网页首帧优化实践](https://zhuanlan.zhihu.com/p/50099963)

> [Egg + React + SSR同构开发](http://ykfe.net/guide/isomorphism.html)