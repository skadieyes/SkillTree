# 跨域

## 参考资料

> [九种跨域方式的实现](https://github.com/ljianshu/Blog/issues/55)

## 概括
> 所谓同源是指"协议+域名+端口"三者相同，即便两个不同的域名指向同一个 ip 地址，也非同源。
> 一个域名地址由协议，子域名，主域名，端口号，资源地址组成

## 同源策略
> 同源策略限制
> 1. Cookie,LocalStorage,IndexDB等存储内容
> 2. DOM节点
> 3. AJAX请求

> 允许跨域加载资源的标签
> 1. img
> 2. link 
> 3. script

> 跨域并不是请求发不出去，请求可以发出去，服务端能收到请求并返回结果，只是被浏览器拦截了。
跨域是为了阻止用户读取到另一个域名下的内容，Ajax可以获取相应，浏览器认为这不安全，所以拦截了响应。

## 跨域解决方案
1. jsonp
> 利用script标签没有限制跨域的漏洞，网页可以得到从其他来源动态产生的JSON数据。JSONP请求一定需要对方服务器的支持才可以。
> jsonp优点是简单而且兼容性好，缺点是仅支持get方法，而且不安全容易遭到XSS攻击。

2. CORS
> CORS需要浏览器和服务端同时支持。
> 浏览器会自动进行CORS通信，实现CORS通信的关键在服务端，只要服务端实现了CORS，就实现了跨域。
> 服务端色褐质Acess-Control-Allow——origin就可以开启 CORS，该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。

3. postMessage
> postMessage是HTML5 XHR LEVEL2的API，为数不多可以跨域操作window的属性，它可以用来解决下面的问题。
> 页面和其他打开的新窗口之间的数据传递。
> 多窗口之间的消息传递。
> 页面与嵌套的iframe之间的消息传递
> 上述三个场景的跨域数据传递。

4. websokcet
> websokcet是HTML5的一个持久化协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一个解决方案。
> websocket是一种双向通信协议，在建立链接之后，websocket的server和client都能主动向对方发送或接收数据。

5. Node中间件代理
> 同源策略是浏览器需要遵循的标准，而如果是服务器向服务器请求就无需遵循同源策略。

代理服务器需要做以下几个步骤
> 1. 接受客户端请求
> 2. 将请求转发给服务器
> 3. 拿到服务器相应数据
> 4. 将response转发给客户端

> 相当于经过两次跨域，浏览器向代理服务器发送请求，代理服务器向服务端发送请求，两次跨域都是遵循同源策略的。

6. nginx反向代理
> 实现原理类似于Node中间件代理，需要你搭建一个nginx服务器，用户转发请求。

> 通过nginx配置一个代理服务器做跳板机，反向代理访问domain2接口，顺便可以修改cookie中domain信息，
方便当前域cookie写入，实现跨域登陆。

7. iframe: window.name,loction.hash,document.domain 

## 总结
1. CORS支持所有类型的HTTP请求，是跨域HTTP请求的根本解决方案
2. JSONP只支持GET请求，JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据
3. 不管是Node中间件代理还是nginx反向代理，主要是通过 服务器之间通信不受同源策略限制
4. 目前用的比较多的跨域方案还是cors和nginx反向代理

